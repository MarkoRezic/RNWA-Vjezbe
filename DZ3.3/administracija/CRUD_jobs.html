<!DOCTYPE html>

<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../index.css" />
    <title>HR schema - Administracija - TIM 2</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>

<script>
    $(document).ready(function () {
        $.get("http://localhost:3001/jobs", function (data) {
            let htmlString =
                `<table class='data-table'>
                <tr>
                    <th>ID</th>
                    <th>Job Title</th>
                    <th>Min Salary</th>
                    <th>Max Salary</th>
                    <th>Actions</th>
                </tr>`
            for (let i = 0; i < data.data.length; i++) {
                let job = data.data[i]
                htmlString +=
                    `<tr>
                    <td>${job.job_id}</td>
                    <td>${job.job_title}</td>
                    <td>${job.min_salary}</td>
                    <td>${job.max_salary}</td>
                    <td><button id=view-${job.job_id}>VIEW</button><button id=edit-${job.job_id}>EDIT</button></td>
                </tr>`
            }
            htmlString += `</table>`
            $("#resultDiv").html(htmlString);
            for (let i = 0; i < data.data.length; i++) {
                let job_id = data.data[i].job_id

                $(`#view-${job_id}`).click(function hideModal() {

                    $.get(`http://localhost:3001/job/${job_id}`, function (data) {
                        let job = data.data
                        $("#job_id_input").val(job.job_id)
                        $("#job_title_input").val(job.job_title)
                        $("#min_salary_input").val(job.min_salary)
                        $("#max_salary_input").val(job.max_salary)
                        console.log(job)
                    });


                    $("#dataModal").children(".input-row").children("input").attr("disabled", "disabled")
                    $("#dataModal").addClass("view")
                    $("#dataModal").removeClass("display-none")
                    $("#modalCover").removeClass("display-none")
                })

                $(`#edit-${job_id}`).click(function hideModal() {

                    $.get(`http://localhost:3001/job/${job_id}`, function (data) {
                        let job = data.data
                        $("#job_id_input").val(job.job_id)
                        $("#job_title_input").val(job.job_title)
                        $("#min_salary_input").val(job.min_salary)
                        $("#max_salary_input").val(job.max_salary)
                        $("#update-btn").click(function updateJob() {
                            $.ajax({
                                url: `http://localhost:3001/job/${job_id}`,
                                method: "PUT",
                                data: {
                                    "job": {
                                        "job_id": $("#job_id_input").val(),
                                        "job_title": $("#job_title_input").val(),
                                        "min_salary": $("#min_salary_input").val(),
                                        "max_salary": $("#max_salary_input").val()
                                    }
                                },
                                success: function (data) {

                                    var str = $(".search").val();

                                    $.get("http://localhost:3001/search/jobs?search=" + str, function (data) {
                                        let htmlString =
                                            `<table class='data-table'>
                                        <tr>
                                            <th>ID</th>
                                            <th>Job Title</th>
                                            <th>Min Salary</th>
                                            <th>Max Salary</th>
                                            <th>Actions</th>
                                        </tr>`
                                        for (let i = 0; i < data.data.length; i++) {
                                            let job = data.data[i]
                                            htmlString +=
                                                `<tr>
                                            <td>${job.job_id}</td>
                                            <td>${job.job_title}</td>
                                            <td>${job.min_salary}</td>
                                            <td>${job.max_salary}</td>
                                            <td><button id=view-${job.job_id}>VIEW</button><button id=edit-${job.job_id}>EDIT</button></td>
                                        </tr>`
                                        }
                                        htmlString += `</table>`
                                        $("#resultDiv").html(htmlString);
                                        for (let i = 0; i < data.data.length; i++) {
                                            let job_id = data.data[i].job_id

                                            $(`#view-${job_id}`).click(function hideModal() {

                                                $.get(`http://localhost:3001/job/${job_id}`, function (data) {
                                                    let job = data.data
                                                    $("#job_id_input").val(job.job_id)
                                                    $("#job_title_input").val(job.job_title)
                                                    $("#min_salary_input").val(job.min_salary)
                                                    $("#max_salary_input").val(job.max_salary)
                                                    console.log(job)
                                                });


                                                $("#dataModal").children(".input-row").children("input").attr("disabled", "disabled")
                                                $("#dataModal").addClass("view")
                                                $("#dataModal").removeClass("display-none")
                                                $("#modalCover").removeClass("display-none")
                                            })

                                            $(`#edit-${job_id}`).click(function hideModal() {

                                                $.get(`http://localhost:3001/job/${job_id}`, function (data) {
                                                    let job = data.data
                                                    $("#job_id_input").val(job.job_id)
                                                    $("#job_title_input").val(job.job_title)
                                                    $("#min_salary_input").val(job.min_salary)
                                                    $("#max_salary_input").val(job.max_salary)
                                                    console.log(job)
                                                });


                                                $("#dataModal").children(".input-row").children("input").removeAttr("disabled")
                                                $("#dataModal").removeClass("view")
                                                $("#dataModal").removeClass("display-none")
                                                $("#modalCover").removeClass("display-none")
                                            })
                                        }


                                        console.log(data)
                                    });

                                    $("#dataModal").addClass("display-none")
                                    $("#modalCover").addClass("display-none")
                                }
                            });
                        })

                        $("#delete-btn").click(function updateJob() {
                            $.ajax({
                                url: `http://localhost:3001/job/${job_id}`,
                                method: "DELETE",
                                success: function (data) {

                                    var str = $(".search").val();

                                    $.get("http://localhost:3001/search/jobs?search=" + str, function (data) {
                                        let htmlString =
                                            `<table class='data-table'>
                                        <tr>
                                            <th>ID</th>
                                            <th>Job Title</th>
                                            <th>Min Salary</th>
                                            <th>Max Salary</th>
                                            <th>Actions</th>
                                        </tr>`
                                        for (let i = 0; i < data.data.length; i++) {
                                            let job = data.data[i]
                                            htmlString +=
                                                `<tr>
                                            <td>${job.job_id}</td>
                                            <td>${job.job_title}</td>
                                            <td>${job.min_salary}</td>
                                            <td>${job.max_salary}</td>
                                            <td><button id=view-${job.job_id}>VIEW</button><button id=edit-${job.job_id}>EDIT</button></td>
                                        </tr>`
                                        }
                                        htmlString += `</table>`
                                        $("#resultDiv").html(htmlString);
                                        for (let i = 0; i < data.data.length; i++) {
                                            let job_id = data.data[i].job_id

                                            $(`#view-${job_id}`).click(function hideModal() {

                                                $.get(`http://localhost:3001/job/${job_id}`, function (data) {
                                                    let job = data.data
                                                    $("#job_id_input").val(job.job_id)
                                                    $("#job_title_input").val(job.job_title)
                                                    $("#min_salary_input").val(job.min_salary)
                                                    $("#max_salary_input").val(job.max_salary)
                                                    console.log(job)
                                                });


                                                $("#dataModal").children(".input-row").children("input").attr("disabled", "disabled")
                                                $("#dataModal").addClass("view")
                                                $("#dataModal").removeClass("display-none")
                                                $("#modalCover").removeClass("display-none")
                                            })

                                            $(`#edit-${job_id}`).click(function hideModal() {

                                                $.get(`http://localhost:3001/job/${job_id}`, function (data) {
                                                    let job = data.data
                                                    $("#job_id_input").val(job.job_id)
                                                    $("#job_title_input").val(job.job_title)
                                                    $("#min_salary_input").val(job.min_salary)
                                                    $("#max_salary_input").val(job.max_salary)
                                                    console.log(job)
                                                });


                                                $("#dataModal").children(".input-row").children("input").removeAttr("disabled")
                                                $("#dataModal").removeClass("view")
                                                $("#dataModal").removeClass("display-none")
                                                $("#modalCover").removeClass("display-none")
                                            })
                                        }


                                        console.log(data)
                                    });

                                    $("#dataModal").addClass("display-none")
                                    $("#modalCover").addClass("display-none")
                                }
                            });
                        })

                        console.log(job)
                    });


                    $("#dataModal").children(".input-row").children("input").removeAttr("disabled")
                    $("#dataModal").removeClass("view")
                    $("#dataModal").removeClass("display-none")
                    $("#modalCover").removeClass("display-none")
                })
            }


            console.log(data)
        });

        $("#modalCover").click(function hideModal() {
            $("#dataModal").addClass("display-none")
            $("#modalCover").addClass("display-none")
        })
        $("#close-btn").click(function hideModal() {
            $("#dataModal").addClass("display-none")
            $("#modalCover").addClass("display-none")
        })
    });

    $(document).ready(function () {
        $(".search").keyup(function () {

            var str = $(".search").val();

            $.get("http://localhost:3001/search/jobs?search=" + str, function (data) {
                let htmlString =
                    `<table class='data-table'>
                <tr>
                    <th>ID</th>
                    <th>Job Title</th>
                    <th>Min Salary</th>
                    <th>Max Salary</th>
                    <th>Actions</th>
                </tr>`
                for (let i = 0; i < data.data.length; i++) {
                    let job = data.data[i]
                    htmlString +=
                        `<tr>
                    <td>${job.job_id}</td>
                    <td>${job.job_title}</td>
                    <td>${job.min_salary}</td>
                    <td>${job.max_salary}</td>
                    <td><button id=view-${job.job_id}>VIEW</button><button id=edit-${job.job_id}>EDIT</button></td>
                </tr>`
                }
                htmlString += `</table>`
                $("#resultDiv").html(htmlString);
                for (let i = 0; i < data.data.length; i++) {
                    let job_id = data.data[i].job_id

                    $(`#view-${job_id}`).click(function hideModal() {

                        $.get(`http://localhost:3001/job/${job_id}`, function (data) {
                            let job = data.data
                            $("#job_id_input").val(job.job_id)
                            $("#job_title_input").val(job.job_title)
                            $("#min_salary_input").val(job.min_salary)
                            $("#max_salary_input").val(job.max_salary)
                            console.log(job)
                        });


                        $("#dataModal").children(".input-row").children("input").attr("disabled", "disabled")
                        $("#dataModal").addClass("view")
                        $("#dataModal").removeClass("display-none")
                        $("#modalCover").removeClass("display-none")
                    })

                    $(`#edit-${job_id}`).click(function hideModal() {

                        $.get(`http://localhost:3001/job/${job_id}`, function (data) {
                            let job = data.data
                            $("#job_id_input").val(job.job_id)
                            $("#job_title_input").val(job.job_title)
                            $("#min_salary_input").val(job.min_salary)
                            $("#max_salary_input").val(job.max_salary)
                            $("#update-btn").click(function updateJob() {
                                $.ajax({
                                    url: `http://localhost:3001/job/${job_id}`,
                                    method: "PUT",
                                    data: {
                                        "job": {
                                            "job_id": $("#job_id_input").val(),
                                            "job_title": $("#job_title_input").val(),
                                            "min_salary": $("#min_salary_input").val(),
                                            "max_salary": $("#max_salary_input").val()
                                        }
                                    },
                                    success: function (data) {

                                        var str = $(".search").val();

                                        $.get("http://localhost:3001/search/jobs?search=" + str, function (data) {
                                            let htmlString =
                                                `<table class='data-table'>
                                        <tr>
                                            <th>ID</th>
                                            <th>Job Title</th>
                                            <th>Min Salary</th>
                                            <th>Max Salary</th>
                                            <th>Actions</th>
                                        </tr>`
                                            for (let i = 0; i < data.data.length; i++) {
                                                let job = data.data[i]
                                                htmlString +=
                                                    `<tr>
                                            <td>${job.job_id}</td>
                                            <td>${job.job_title}</td>
                                            <td>${job.min_salary}</td>
                                            <td>${job.max_salary}</td>
                                            <td><button id=view-${job.job_id}>VIEW</button><button id=edit-${job.job_id}>EDIT</button></td>
                                        </tr>`
                                            }
                                            htmlString += `</table>`
                                            $("#resultDiv").html(htmlString);
                                            for (let i = 0; i < data.data.length; i++) {
                                                let job_id = data.data[i].job_id

                                                $(`#view-${job_id}`).click(function hideModal() {

                                                    $.get(`http://localhost:3001/job/${job_id}`, function (data) {
                                                        let job = data.data
                                                        $("#job_id_input").val(job.job_id)
                                                        $("#job_title_input").val(job.job_title)
                                                        $("#min_salary_input").val(job.min_salary)
                                                        $("#max_salary_input").val(job.max_salary)
                                                        console.log(job)
                                                    });


                                                    $("#dataModal").children(".input-row").children("input").attr("disabled", "disabled")
                                                    $("#dataModal").addClass("view")
                                                    $("#dataModal").removeClass("display-none")
                                                    $("#modalCover").removeClass("display-none")
                                                })

                                                $(`#edit-${job_id}`).click(function hideModal() {

                                                    $.get(`http://localhost:3001/job/${job_id}`, function (data) {
                                                        let job = data.data
                                                        $("#job_id_input").val(job.job_id)
                                                        $("#job_title_input").val(job.job_title)
                                                        $("#min_salary_input").val(job.min_salary)
                                                        $("#max_salary_input").val(job.max_salary)
                                                        console.log(job)
                                                    });


                                                    $("#dataModal").children(".input-row").children("input").removeAttr("disabled")
                                                    $("#dataModal").removeClass("view")
                                                    $("#dataModal").removeClass("display-none")
                                                    $("#modalCover").removeClass("display-none")
                                                })
                                            }


                                            console.log(data)
                                        });

                                        $("#dataModal").addClass("display-none")
                                        $("#modalCover").addClass("display-none")
                                    }
                                });
                            })

                            $("#delete-btn").click(function updateJob() {
                                $.ajax({
                                    url: `http://localhost:3001/job/${job_id}`,
                                    method: "DELETE",
                                    success: function (data) {

                                        var str = $(".search").val();

                                        $.get("http://localhost:3001/search/jobs?search=" + str, function (data) {
                                            let htmlString =
                                                `<table class='data-table'>
                                        <tr>
                                            <th>ID</th>
                                            <th>Job Title</th>
                                            <th>Min Salary</th>
                                            <th>Max Salary</th>
                                            <th>Actions</th>
                                        </tr>`
                                            for (let i = 0; i < data.data.length; i++) {
                                                let job = data.data[i]
                                                htmlString +=
                                                    `<tr>
                                            <td>${job.job_id}</td>
                                            <td>${job.job_title}</td>
                                            <td>${job.min_salary}</td>
                                            <td>${job.max_salary}</td>
                                            <td><button id=view-${job.job_id}>VIEW</button><button id=edit-${job.job_id}>EDIT</button></td>
                                        </tr>`
                                            }
                                            htmlString += `</table>`
                                            $("#resultDiv").html(htmlString);
                                            for (let i = 0; i < data.data.length; i++) {
                                                let job_id = data.data[i].job_id

                                                $(`#view-${job_id}`).click(function hideModal() {

                                                    $.get(`http://localhost:3001/job/${job_id}`, function (data) {
                                                        let job = data.data
                                                        $("#job_id_input").val(job.job_id)
                                                        $("#job_title_input").val(job.job_title)
                                                        $("#min_salary_input").val(job.min_salary)
                                                        $("#max_salary_input").val(job.max_salary)
                                                        console.log(job)
                                                    });


                                                    $("#dataModal").children(".input-row").children("input").attr("disabled", "disabled")
                                                    $("#dataModal").addClass("view")
                                                    $("#dataModal").removeClass("display-none")
                                                    $("#modalCover").removeClass("display-none")
                                                })

                                                $(`#edit-${job_id}`).click(function hideModal() {

                                                    $.get(`http://localhost:3001/job/${job_id}`, function (data) {
                                                        let job = data.data
                                                        $("#job_id_input").val(job.job_id)
                                                        $("#job_title_input").val(job.job_title)
                                                        $("#min_salary_input").val(job.min_salary)
                                                        $("#max_salary_input").val(job.max_salary)
                                                        console.log(job)
                                                    });


                                                    $("#dataModal").children(".input-row").children("input").removeAttr("disabled")
                                                    $("#dataModal").removeClass("view")
                                                    $("#dataModal").removeClass("display-none")
                                                    $("#modalCover").removeClass("display-none")
                                                })
                                            }


                                            console.log(data)
                                        });

                                        $("#dataModal").addClass("display-none")
                                        $("#modalCover").addClass("display-none")
                                    }
                                });
                            })

                            console.log(job)
                        });


                        $("#dataModal").children(".input-row").children("input").removeAttr("disabled")
                        $("#dataModal").removeClass("view")
                        $("#dataModal").removeClass("display-none")
                        $("#modalCover").removeClass("display-none")
                    })
                }


                console.log(data)
            });
        });
    });
</script>

<body>
    <header class="nav-header surface-12">
        <nav class="navigation">
            <a href="../index.html">Naslovna</a>
            <a href="../odjeli.html">Odjeli</a>
            <a href="../zaposlenici.html">Zaposlenici</a>
            <a href="../poslovi.html">Poslovi</a>
            <a class="active">Administracija</a>
        </nav>
    </header>

    <div class="divider surface-8 mv5"></div>

    <header class="nav-header surface-12">
        <nav class="navigation">
            <a href="CRUD_employees.html">Employee</a>
            <a class="active">Jobs</a>
        </nav>
    </header>

    <div class="sidebar-content-wrapper">
        <div class="sidebar"></div>

        <section class="main-content">
            <article>
                <header>
                    <h2 class="emph-medium">Poslovi pretraga JQuery</h2>

                    <div class="divider surface-8"></div>
                </header>
                <form>
                    <input type="text" placeholder="Pretraga..." class="search surface-12" />
                </form>
                <div id="resultDiv"></div>
            </article>
        </section>
    </div>

    <footer class="footer surface-12">
        <p class="emph-high">© 2022 RZSoft</p>
    </footer>
    <div id="modalCover" class="display-none"></div>
    <div id="dataModal" class="display-none">
        <div class="input-row">
            <label for="job_id">Job ID</label>
            <input id="job_id_input" name="job_id" type="text" />
        </div>
        <div class="input-row">
            <label for="job_title">Job Title</label>
            <input id="job_title_input" name="job_title" type="text" />
        </div>
        <div class="input-row">
            <label for="min_salary">Min Salary</label>
            <input id="min_salary_input" name="min_salary" type="text" />
        </div>
        <div class="input-row">
            <label for="max_salary">Max Salary</label>
            <input id="max_salary_input" name="max_salary" type="text" />
        </div>

        <div class="divider surface-8 mv5"></div>

        <div class="button-row">
            <button id="close-btn">CLOSE</button>
            <button id="update-btn">UPDATE</button>
            <button id="delete-btn">DELETE</button>
        </div>
    </div>
</body>

</html>